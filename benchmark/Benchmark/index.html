<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Benchmark (benchmark.Benchmark)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">benchmark</a> &#x00BB; Benchmark</nav><header class="odoc-preamble"><h1>Module <code><span>Benchmark</span></code></h1><p>Benchmark running times of code.</p><p>This module implements benchmarking functions for measuring the run-time of one or many functions using latency (multiple repetitions) or throughput (repeat until some time period has passed) tests.</p><p><b>Examples:</b> Run the function <code>f</code> with input <code>5000</code> for <code>10</code> iterations and print the CPU times:</p><pre class="language-ocaml"><code>Benchmark.latency1 10 f 5000                        </code></pre><p>Run the tests <code>foo</code>, <code>bar</code> and <code>baz</code> three times for at least <code>8</code> seconds each, printing the results of each test, and then print a cross tabulation of the results:</p><pre class="language-ocaml"><code>open Benchmark
let res = throughputN ~repeat:3 8 [(&quot;foo&quot;, foo, 1000000);
                                   (&quot;bar&quot;, bar, 2000000);
                                   (&quot;baz&quot;, baz, 3000000); ] in
print_newline();
tabulate res                                                    </code></pre><p>Time how long it takes to some piece of code:</p><pre class="language-ocaml"><code>let t0 = Benchmark.make 0L in
(* do something here *)
let b = Benchmark.sub (Benchmark.make 0L) t0 in
print_endline &quot;Benchmark results:&quot;;
print_endline (Benchmark.to_string b)                       </code></pre></header><nav class="odoc-toc"><ul><li><a href="#timing-and-samples-structures">Timing and samples structures</a></li><li><a href="#timing-functions">Timing functions</a></li><li><a href="#benchmark-tree">Benchmark Tree</a></li></ul></nav><div class="odoc-content"><h3 id="timing-and-samples-structures"><a href="#timing-and-samples-structures" class="anchor"></a>Timing and samples structures</h3><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><ol><li id="type-t.wall" class="def record field anchored"><a href="#type-t.wall" class="anchor"></a><code><span>wall : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Wallclock time (in seconds)</p><span class="comment-delim">*)</span></div></li><li id="type-t.utime" class="def record field anchored"><a href="#type-t.utime" class="anchor"></a><code><span>utime : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>This process User CPU time (in seconds)</p><span class="comment-delim">*)</span></div></li><li id="type-t.stime" class="def record field anchored"><a href="#type-t.stime" class="anchor"></a><code><span>stime : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>This process System CPU time (in seconds)</p><span class="comment-delim">*)</span></div></li><li id="type-t.cutime" class="def record field anchored"><a href="#type-t.cutime" class="anchor"></a><code><span>cutime : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Child process User CPU time (in seconds)</p><span class="comment-delim">*)</span></div></li><li id="type-t.cstime" class="def record field anchored"><a href="#type-t.cstime" class="anchor"></a><code><span>cstime : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Child process System CPU time (in seconds)</p><span class="comment-delim">*)</span></div></li><li id="type-t.iters" class="def record field anchored"><a href="#type-t.iters" class="anchor"></a><code><span>iters : <a href="../../ocaml/Stdlib/Int64/index.html#type-t">Stdlib.Int64.t</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Number of iterations.</p><span class="comment-delim">*)</span></div></li><li id="type-t.minor_words" class="def record field anchored"><a href="#type-t.minor_words" class="anchor"></a><code><span>minor_words : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Bytes allocated on minor heap</p><span class="comment-delim">*)</span></div></li><li id="type-t.major_words" class="def record field anchored"><a href="#type-t.major_words" class="anchor"></a><code><span>major_words : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Bytes allocated on major heap, incl. promoted</p><span class="comment-delim">*)</span></div></li><li id="type-t.promoted_words" class="def record field anchored"><a href="#type-t.promoted_words" class="anchor"></a><code><span>promoted_words : float;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Bytes moved from minor heap to major heap</p><span class="comment-delim">*)</span></div></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The information returned by timing tests.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-style"><a href="#type-style" class="anchor"></a><code><span><span class="keyword">type</span> style</span><span> = </span></code><ol><li id="type-style.No_child" class="def variant constructor anchored"><a href="#type-style.No_child" class="anchor"></a><code><span>| </span><span><span class="constructor">No_child</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Do not print child CPU times</p><span class="comment-delim">*)</span></div></li><li id="type-style.No_parent" class="def variant constructor anchored"><a href="#type-style.No_parent" class="anchor"></a><code><span>| </span><span><span class="constructor">No_parent</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Do not print parent CPU times</p><span class="comment-delim">*)</span></div></li><li id="type-style.All" class="def variant constructor anchored"><a href="#type-style.All" class="anchor"></a><code><span>| </span><span><span class="constructor">All</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Print parent and child CPU times</p><span class="comment-delim">*)</span></div></li><li id="type-style.Auto" class="def variant constructor anchored"><a href="#type-style.Auto" class="anchor"></a><code><span>| </span><span><span class="constructor">Auto</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Same as <code>No_child</code> unless there is child CPU used</p><span class="comment-delim">*)</span></div></li><li id="type-style.Nil" class="def variant constructor anchored"><a href="#type-style.Nil" class="anchor"></a><code><span>| </span><span><span class="constructor">Nil</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Print nothing</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Style of the output.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : <span><a href="../../ocaml/Stdlib/Int64/index.html#type-t">Stdlib.Int64.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>Benchmark.make n</code> create a new <a href="#type-t"><code>Benchmark.t</code></a> structure with current time values and <code>n</code> iterations. Only the integer part of <code>n</code> is used, the fractional part is ignored.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add"><a href="#val-add" class="anchor"></a><code><span><span class="keyword">val</span> add : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>Benchmark.add b1 b2</code> add <a href="#type-t"><code>Benchmark.t</code></a> structure <code>b1</code> to <code>b2</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sub"><a href="#val-sub" class="anchor"></a><code><span><span class="keyword">val</span> sub : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>Benchmark.sub b1 b2</code> subtract <a href="#type-t"><code>Benchmark.t</code></a> structure <code>b2</code> from <code>b1</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_string"><a href="#val-to_string" class="anchor"></a><code><span><span class="keyword">val</span> to_string : <span><span class="optlabel">?style</span>:<a href="#type-style">style</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?fwidth</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?fdigits</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>Benchmark.to_string ?style ?fwidth ?fdigits b</code> converts the <a href="#type-t"><code>Benchmark.t</code></a> structure to a formatted string.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">style</span> <p>printing style (default: <code>Auto</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">fwidth</span> <p>number of chars reserved for the numbers (default: <code>5</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">fdigits</span> <p>number of fractional digits of the numbers (default: <code>2</code>)</p></li></ul></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-samples"><a href="#type-samples" class="anchor"></a><code><span><span class="keyword">type</span> samples</span><span> = <span><span>(string * <span><a href="#type-t">t</a> list</span>)</span> list</span></span></code></div><div class="spec-doc"><p>Association list that links the names of the tests to the list of their timings.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-merge"><a href="#val-merge" class="anchor"></a><code><span><span class="keyword">val</span> merge : <span><a href="#type-samples">samples</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-samples">samples</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-samples">samples</a></span></code></div><div class="spec-doc"><p><code>merge l1 l2</code> merges the two association lists of timings <code>l1</code> and <code>l2</code> into a single one, concatenating the timings for the same names of <code>l1</code> and <code>l2</code>.</p></div></div><h3 id="timing-functions"><a href="#timing-functions" class="anchor"></a>Timing functions</h3><div class="odoc-spec"><div class="spec value anchored" id="val-throughputN"><a href="#val-throughputN" class="anchor"></a><code><span><span class="keyword">val</span> throughputN : 
  <span><span class="optlabel">?min_count</span>:<a href="../../ocaml/Stdlib/Int64/index.html#type-t">Stdlib.Int64.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?style</span>:<a href="#type-style">style</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fwidth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fdigits</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?repeat</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string * <span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> * <span class="type-var">'a</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-samples">samples</a></span></code></div><div class="spec-doc"><p><code>Benchmark.throughputN ?min_count ?style ?fwidth ?fdigits t
      funs</code> runs each function in list <code>funs</code> for at least <code>t &gt; 0</code> seconds. The list <code>funs</code> has the structure: <code>[(name1, f1, x1);
      (name2, f2, x2); ...]</code>, where <code>name1</code> is the name to label the first test, <code>f1</code> is the function to run, and <code>x1</code> is its input,... If <code>~style</code> is not <code>Nil</code>, then the results are printed. Returns the resulting list which can be passed to <a href="#val-tabulate"><code>Benchmark.tabulate</code></a> if you want a comparison table.</p><p>REMARK that <code>t</code> is the running time of the functions, not of the repetition loop. Thus a very fast running function will need lots of repetitions to make a difference of <code>t</code> seconds to the empty loop. In this case, the running time of the loop will dominate the whole process which can therefore take much longer than <code>t</code> seconds. If you are only interested in the <i>relative</i> times of fast functions and not in their real running times, we recommend you wrap each of them in a loop.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">min_count</span> <p>a warning will be printed if the number of runs is less than <code>min_count</code>. This is a first defense against meaningless results. (default: <code>4L</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">style</span> <p>printing style (default: <code>Auto</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">fwidth</span> <p>number of chars reserved for the numbers (default: <code>5</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">fdigits</span> <p>number of fractional digits of the numbers (default: <code>2</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">repeat</span> <p>number of times each function running time is measured. The default is <code>1</code> to be compatible with the former version of this library but it is highly recommended to set it to a higher number to enable confidence statistics to be performed by <a href="#val-tabulate"><code>Benchmark.tabulate</code></a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-throughput1"><a href="#val-throughput1" class="anchor"></a><code><span><span class="keyword">val</span> throughput1 : 
  <span><span class="optlabel">?min_count</span>:<a href="../../ocaml/Stdlib/Int64/index.html#type-t">Stdlib.Int64.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?style</span>:<a href="#type-style">style</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fwidth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fdigits</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?repeat</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-samples">samples</a></span></code></div><div class="spec-doc"><p><code>Benchmark.throughput1 ?min_count ?style ?fwidth ?fdigits t ?name f x</code> runs one function <code>f</code> with input <code>x</code> for at least <code>t</code> seconds, and returns the result, which is also printed unless <code>~style</code> is <code>Nil</code>. See <a href="#val-throughputN"><code>Benchmark.throughputN</code></a> for more information.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-latencyN"><a href="#val-latencyN" class="anchor"></a><code><span><span class="keyword">val</span> latencyN : 
  <span><span class="optlabel">?min_cpu</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?style</span>:<a href="#type-style">style</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fwidth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fdigits</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?repeat</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../ocaml/Stdlib/Int64/index.html#type-t">Stdlib.Int64.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string * <span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> * <span class="type-var">'a</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-samples">samples</a></span></code></div><div class="spec-doc"><p><code>Benchmark.latencyN ?min_cpu ?style ?fwidth ?fdigits n funs</code> runs each function in list <code>funs</code> for <code>n</code> iterations. <code>n</code> must be at least 4. The list <code>funs</code> has the structure: <code>[(name1, f1, x1);
      (name2, f2, x2); ...]</code>, where <code>name1</code> is the name to label the first test, <code>f1</code> is the function to run, and <code>x1</code> is its input,... If style is not <code>Nil</code>, then the results are printed. Returns the results list, which can be passed to <a href="#val-tabulate"><code>Benchmark.tabulate</code></a> if you want to print a comparison table.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Invalid_argument</code> <p>if <code>n &lt; 4L</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">min_cpu</span> <p>a warning will be printed if the total CPU time is less than <code>min_cpu</code>. This is a first defense against meaningless results (default: <code>0.4</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">style</span> <p>printing style (default: <code>Auto</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">fwidth</span> <p>number of chars reserved for the numbers (default: <code>5</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">fdigits</span> <p>number of fractional digits of the numbers (default: <code>2</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">repeat</span> <p>number of times each function running time is measured. The default is <code>1</code> to be compatible with the former version of this library but it is highly recommended to set it to a higher number to enable confidence statistics to be performed by <a href="#val-tabulate"><code>Benchmark.tabulate</code></a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-latency1"><a href="#val-latency1" class="anchor"></a><code><span><span class="keyword">val</span> latency1 : 
  <span><span class="optlabel">?min_cpu</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?style</span>:<a href="#type-style">style</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fwidth</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?fdigits</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?repeat</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../ocaml/Stdlib/Int64/index.html#type-t">Stdlib.Int64.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-samples">samples</a></span></code></div><div class="spec-doc"><p><code>Benchmark.latency1 ?min_cpu ?style ?fwidth ?fdigits n ?name f x</code> runs the function <code>f</code> with input <code>x</code> for <code>n</code> iterations, and returns the results, which are also printed unless <code>~style</code> is <code>Nil</code>. See <a href="#val-latencyN"><code>Benchmark.latencyN</code></a> for more information.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tabulate"><a href="#val-tabulate" class="anchor"></a><code><span><span class="keyword">val</span> tabulate : <span><span class="optlabel">?no_parent</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?confidence</span>:float <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-samples">samples</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>Benchmark.tablulate results</code> prints a comparison table for a list of <code>results</code> obtained by <a href="#val-latencyN"><code>Benchmark.latencyN</code></a> or <a href="#val-throughputN"><code>Benchmark.throughputN</code></a> with each function compared to all the others. The table is of the type</p><pre class="language-ocaml"><code>    Rate name1 name2 ...   OR          s/iter name1 name2 ...
name1  #/s    --   r12             name1   #       --   r12
name2  #/s   r21    --             name2   #      r21    --
...                                ...                            </code></pre><p>where name1, name2,... are the labels of the tests sorted from slowest to fastest and rij says how much namei is faster (or slower if &lt; 0) than namej (technically it is equal to (ri - rj) expressed in percents of rj where ri and rj are the rates of namei and namej respectively).</p><p>If several results are associated to a given name, they are used to compute a Student's statistic to check whether the rates are significantly different. If ri and rj are not believed to be different, rij will be printed between brackets.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">no_parent</span> <p>if <code>true</code>, only take in account the times of the children (default: <code>false</code>).</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">confidence</span> <p>is used to determine the confidence interval for the Student's test. (default: <code>0.95</code>).</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-print_gc"><a href="#val-print_gc" class="anchor"></a><code><span><span class="keyword">val</span> print_gc : <span><a href="#type-samples">samples</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Print GC statistics.</p></div></div><h3 id="benchmark-tree"><a href="#benchmark-tree" class="anchor"></a>Benchmark Tree</h3><p>Naming benchmarks within a hierarchy that allows to run them all, or filter them so that only a subset is run.</p><div class="odoc-spec"><div class="spec module anchored" id="module-Tree"><a href="#module-Tree" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Tree/index.html">Tree</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
