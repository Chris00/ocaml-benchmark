<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Benchmark (benchmark.Benchmark)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../index.html">benchmark</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Benchmark</span></h1></header><p>Benchmark running times of code.</p><p>This module implements benchmarking functions for measuring the
run-time of one or many functions using latency (multiple
repetitions) or throughput (repeat until some time period has
passed) tests.</p><p><b>Examples:</b>
Run the function <code class="code">f</code> with input <code class="code">5000</code> for <code class="code">10</code> iterations and
print the CPU times:
</p><pre><code class="code">    Benchmark.latency1 10 f 5000</code></pre><p>Run the tests <code class="code">foo</code>, <code class="code">bar</code> and <code class="code">baz</code> three times for at least <code class="code">8</code>
seconds each, printing the results of each test, and then print a
cross tabulation of the results:
</p><pre><code class="code">    open Benchmark
    let res = throughputN ~repeat:3 8 [(&quot;foo&quot;, foo, 1000000);
                                       (&quot;bar&quot;, bar, 2000000);
                                       (&quot;baz&quot;, baz, 3000000); ] in
    print_newline();
    tabulate res</code></pre><p>Time how long it takes to some piece of code:
</p><pre><code class="code">    let t0 = Benchmark.make 0L in
    (* do something here *)
    let b = Benchmark.sub (Benchmark.make 0L) t0 in
    print_endline &quot;Benchmark results:&quot;;
    print_endline (Benchmark.to_string b)</code></pre><h3>Timing and samples structures</h3><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-t.wall" class="anchored"><td class="def field"><a href="#type-t.wall" class="anchor"></a><code>wall : float;</code></td><td class="doc"><p>(** Wallclock time (in seconds) *)</p></td></tr><tr id="type-t.utime" class="anchored"><td class="def field"><a href="#type-t.utime" class="anchor"></a><code>utime : float;</code></td><td class="doc"><p>(** This process User CPU time (in seconds) *)</p></td></tr><tr id="type-t.stime" class="anchored"><td class="def field"><a href="#type-t.stime" class="anchor"></a><code>stime : float;</code></td><td class="doc"><p>(** This process System CPU time (in seconds) *)</p></td></tr><tr id="type-t.cutime" class="anchored"><td class="def field"><a href="#type-t.cutime" class="anchor"></a><code>cutime : float;</code></td><td class="doc"><p>(** Child process User CPU time (in seconds) *)</p></td></tr><tr id="type-t.cstime" class="anchored"><td class="def field"><a href="#type-t.cstime" class="anchor"></a><code>cstime : float;</code></td><td class="doc"><p>(** Child process System CPU time (in seconds) *)</p></td></tr><tr id="type-t.iters" class="anchored"><td class="def field"><a href="#type-t.iters" class="anchor"></a><code>iters : Int64.t;</code></td><td class="doc"><p>(** Number of iterations. *)</p></td></tr></table><code>}</code><code></code></div><div class="doc"><p>The information returned by timing tests.</p></div></div><div class="spec type" id="type-style"><a href="#type-style" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>style</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-style.No_child" class="anchored"><td class="def constructor"><a href="#type-style.No_child" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">No_child</span></code></td><td class="doc"><p>(** Do not print child CPU times *)</p></td></tr><tr id="type-style.No_parent" class="anchored"><td class="def constructor"><a href="#type-style.No_parent" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">No_parent</span></code></td><td class="doc"><p>(** Do not print parent CPU times *)</p></td></tr><tr id="type-style.All" class="anchored"><td class="def constructor"><a href="#type-style.All" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">All</span></code></td><td class="doc"><p>(** Print parent and child CPU times *)</p></td></tr><tr id="type-style.Auto" class="anchored"><td class="def constructor"><a href="#type-style.Auto" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Auto</span></code></td><td class="doc"><p>(** Same as <code class="code">No_child</code> unless there is child CPU used *)</p></td></tr><tr id="type-style.Nil" class="anchored"><td class="def constructor"><a href="#type-style.Nil" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Nil</span></code></td><td class="doc"><p>(** Print nothing *)</p></td></tr></table><code></code></div><div class="doc"><p>Style of the output.</p></div></div><div class="spec val" id="val-make"><a href="#val-make" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make : Int64.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">Benchmark.make n</code> create a new <a href="index.html#type-t">Benchmark.t</a> structure with
current time values and <code class="code">n</code> iterations. Only the integer part of
<code class="code">n</code> is used, the fractional part is ignored.</p></div></div><div class="spec val" id="val-add"><a href="#val-add" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>add : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">Benchmark.add b1 b2</code> add <a href="index.html#type-t">Benchmark.t</a> structure <code class="code">b1</code> to <code class="code">b2</code>.</p></div></div><div class="spec val" id="val-sub"><a href="#val-sub" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>sub : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">Benchmark.sub b1 b2</code> subtract <a href="index.html#type-t">Benchmark.t</a> structure <code class="code">b2</code>
from <code class="code">b1</code>.</p></div></div><div class="spec val" id="val-to_string"><a href="#val-to_string" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>to_string : ?&#8288;style:<a href="index.html#type-style">style</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;fwidth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;fdigits:int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p><code class="code">Benchmark.to_string ?style ?fwidth ?fdigits b</code> converts the
<a href="index.html#type-t">Benchmark.t</a> structure to a formatted string.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">style</span>: printing style (default: <code class="code">Auto</code>)</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">fwidth</span>: number of chars reserved for the numbers (default: <code class="code">5</code>)</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">fdigits</span>: number of fractional digits of the numbers (default: <code class="code">2</code>)</li></ul></div></div><div class="spec type" id="type-samples"><a href="#type-samples" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>samples</code><code><span class="keyword"> = </span>(string<span class="keyword"> * </span><a href="index.html#type-t">t</a> list) list</code><code></code></div><div class="doc"><p>Association list that links the names of the tests to the list
of their timings.</p></div></div><div class="spec val" id="val-merge"><a href="#val-merge" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>merge : <a href="index.html#type-samples">samples</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-samples">samples</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-samples">samples</a></code></div><div class="doc"><p><code class="code">merge l1 l2</code> merges the two association lists of timings <code class="code">l1</code>
and <code class="code">l2</code> into a single one, concatenating the timings for the same
names of <code class="code">l1</code> and <code class="code">l2</code>.</p></div></div><h3>Timing functions</h3><div class="spec val" id="val-throughputN"><a href="#val-throughputN" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>throughputN : ?&#8288;min_count:Int64.t <span class="keyword">&#8209;&gt;</span> ?&#8288;style:<a href="index.html#type-style">style</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;fwidth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;fdigits:int <span class="keyword">&#8209;&gt;</span> ?&#8288;repeat:int <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> (string<span class="keyword"> * </span>(<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span>)<span class="keyword"> * </span><span class="type-var">'a</span>) list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-samples">samples</a></code></div><div class="doc"><p><code class="code">Benchmark.throughputN ?min_count ?style ?fwidth ?fdigits t
      funs</code> runs each function in list <code class="code">funs</code> for at least <code class="code">t &gt; 0</code>
seconds. The list <code class="code">funs</code> has the structure: <code class="code">[(name1, f1, x1);
      (name2, f2, x2); ...]</code>, where <code class="code">name1</code> is the name to label the
first test, <code class="code">f1</code> is the function to run, and <code class="code">x1</code> is its
input,... If <code class="code">~style</code> is not <code class="code">Nil</code>, then the results are
printed. Returns the resulting list which can be passed to
<a href="index.html#val-tabulate">Benchmark.tabulate</a> if you want a comparison table.</p><p>REMARK that <code class="code">t</code> is the running time of the functions, not of the
repetition loop. Thus a very fast running function will need
lots of repetitions to make a difference of <code class="code">t</code> seconds to the
empty loop. In this case, the running time of the loop will
dominate the whole process which can therefore take much longer
than <code class="code">t</code> seconds. If you are only interested in the <i>relative</i> times of fast functions and not in their real running
times, we recommend you wrap each of them in a loop.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">min_count</span>: a warning will be printed if the number of runs is
less than <code class="code">min_count</code>. This is a first defense against
meaningless results. (default: <code class="code">4L</code>)</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">style</span>: printing style (default: <code class="code">Auto</code>)</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">fwidth</span>: number of chars reserved for the numbers (default: <code class="code">5</code>)</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">fdigits</span>: number of fractional digits of the numbers (default: <code class="code">2</code>)</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">repeat</span>: number of times each function running time is measured.
The default is <code class="code">1</code> to be compatible with the former
version of this library but it is highly recommended
to set it to a higher number to enable confidence
statistics to be performed by <a href="index.html#val-tabulate">Benchmark.tabulate</a>.</li></ul></div></div><div class="spec val" id="val-throughput1"><a href="#val-throughput1" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>throughput1 : ?&#8288;min_count:Int64.t <span class="keyword">&#8209;&gt;</span> ?&#8288;style:<a href="index.html#type-style">style</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;fwidth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;fdigits:int <span class="keyword">&#8209;&gt;</span> ?&#8288;repeat:int <span class="keyword">&#8209;&gt;</span> int <span class="keyword">&#8209;&gt;</span> ?&#8288;name:string <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-samples">samples</a></code></div><div class="doc"><p><code class="code">Benchmark.throughput1 ?min_count ?style ?fwidth ?fdigits t ?name f x</code>
runs one function <code class="code">f</code> with input <code class="code">x</code> for at least <code class="code">t</code> seconds, and
returns the result, which is also printed unless <code class="code">~style</code> is
<code class="code">Nil</code>. See <a href="index.html#val-throughputN">Benchmark.throughputN</a> for more information.</p></div></div><div class="spec val" id="val-latencyN"><a href="#val-latencyN" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>latencyN : ?&#8288;min_cpu:float <span class="keyword">&#8209;&gt;</span> ?&#8288;style:<a href="index.html#type-style">style</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;fwidth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;fdigits:int <span class="keyword">&#8209;&gt;</span> ?&#8288;repeat:int <span class="keyword">&#8209;&gt;</span> Int64.t <span class="keyword">&#8209;&gt;</span> (string<span class="keyword"> * </span>(<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span>)<span class="keyword"> * </span><span class="type-var">'a</span>) list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-samples">samples</a></code></div><div class="doc"><p><code class="code">Benchmark.latencyN ?min_cpu ?style ?fwidth ?fdigits n funs</code>
runs each function in list <code class="code">funs</code> for <code class="code">n</code> iterations. <code class="code">n</code> must be
at least 4. The list <code class="code">funs</code> has the structure: <code class="code">[(name1, f1, x1);
      (name2, f2, x2); ...]</code>, where <code class="code">name1</code> is the name to label the
first test, <code class="code">f1</code> is the function to run, and <code class="code">x1</code> is its input,...
If style is not <code class="code">Nil</code>, then the results are printed. Returns the
results list, which can be passed to <a href="index.html#val-tabulate">Benchmark.tabulate</a> if you
want to print a comparison table.</p><ul class="at-tag"><li><span class="at-tag raise">Raises</span> <span class="module-path">Invalid_argument</span>: if <code class="code">n &lt; 4L</code>.</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">min_cpu</span>: a warning will be printed if the total CPU time is
less than <code class="code">min_cpu</code>. This is a first defense against
meaningless results (default: <code class="code">0.4</code>).</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">style</span>: printing style (default: <code class="code">Auto</code>).</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">fwidth</span>: number of chars reserved for the numbers (default: <code class="code">5</code>).</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">fdigits</span>: number of fractional digits of the numbers (default: <code class="code">2</code>).</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">repeat</span>: number of times each function running time is measured.
The default is <code class="code">1</code> to be compatible with the former
version of this library but it is highly recommended
to set it to a higher number to enable confidence
statistics to be performed by <a href="index.html#val-tabulate">Benchmark.tabulate</a>.</li></ul></div></div><div class="spec val" id="val-latency1"><a href="#val-latency1" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>latency1 : ?&#8288;min_cpu:float <span class="keyword">&#8209;&gt;</span> ?&#8288;style:<a href="index.html#type-style">style</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;fwidth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;fdigits:int <span class="keyword">&#8209;&gt;</span> ?&#8288;repeat:int <span class="keyword">&#8209;&gt;</span> Int64.t <span class="keyword">&#8209;&gt;</span> ?&#8288;name:string <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-samples">samples</a></code></div><div class="doc"><p><code class="code">Benchmark.latency1 ?min_cpu ?style ?fwidth ?fdigits n ?name f x</code>
runs the function <code class="code">f</code> with input <code class="code">x</code> for <code class="code">n</code> iterations, and
returns the results, which are also printed unless <code class="code">~style</code> is
<code class="code">Nil</code>. See <a href="index.html#val-latencyN">Benchmark.latencyN</a> for more information.</p></div></div><div class="spec val" id="val-tabulate"><a href="#val-tabulate" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>tabulate : ?&#8288;no_parent:bool <span class="keyword">&#8209;&gt;</span> ?&#8288;confidence:float <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-samples">samples</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">Benchmark.tablulate results</code> prints a comparison table for a
list of <code class="code">results</code> obtained by <a href="index.html#val-latencyN">Benchmark.latencyN</a> or
<a href="index.html#val-throughputN">Benchmark.throughputN</a> with each function compared to all the
others. The table is of the type</p><pre><code class="code">Rate name1 name2 ...   OR          s/iter name1 name2 ...
        name1  #/s    --   r12             name1   #       --   r12
        name2  #/s   r21    --             name2   #      r21    --
        ...                                ...</code></pre><p>where name1, name2,... are the labels of the tests sorted from
slowest to fastest and rij says how much namei is faster (or
slower if &lt; 0) than namej (technically it is equal to (ri - rj)
expressed in percents of rj where ri and rj are the rates of namei
and namej respectively).</p><p>If several results are associated to a given name, they are used
to compute a Student's statistic to check whether the rates are
significantly different. If ri and rj are not believed to be
different, rij will be printed between brackets.</p><ul class="at-tag"><li><span class="at-tag parameter">Parameter</span> <span class="module-path">no_parent</span>: if <code class="code">true</code>, only take in account the times of the
children (default: <code class="code">false</code>).</li><li><span class="at-tag parameter">Parameter</span> <span class="module-path">confidence</span>: is used to determine the confidence interval for
the Student's test. (default: <code class="code">0.95</code>).</li></ul></div></div><h3>Benchmark Tree</h3><p>Naming benchmarks within a hierarchy that allows to run them all,
or filter them so that only a subset is run.</p><div class="spec module" id="module-Tree"><a href="#module-Tree" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Tree/index.html">Tree</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div></body></html>